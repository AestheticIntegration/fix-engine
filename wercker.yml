build:
  box:
    id: ocaml/opam2
    tag: debian-9-ocaml-4.06
    entrypoint: /usr/bin/sudo -u root --preserve-env opam config exec --
    cmd: /bin/bash

  steps:
    - script:
        name: dune make
        code: |          
          set -ex
          apt-get update && apt-get install -y libgmp-dev zlib1g-dev
          export OPAMROOT=/home/opam/.opam
          opam update
          opam install dune
          make opam1-setup
          curl -s "https://storage.googleapis.com/imandra-client/imandra_client_$(curl -s -L "https://storage.googleapis.com/imandra-installer/last-version").tar.gz" > imandra_extract.tgz
          tar xzvf imandra_extract.tg`
          ln -s ./bin/imandra_extract /home/opam/.opam/4.06/bin/
          opam pin add https://github.com/AestheticIntegration/imandra-prelude.git
          make
