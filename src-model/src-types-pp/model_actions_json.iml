(* Aesthetic Integration copyright 2019 *)
open Actions;;
open Base_types_json;;
open Datetime_json;;
open Json_generator_utils;;
open Model_records_json;;
open Yojson;;

let mod_act_move_to_json (x)  : json =
    assoc_filter_nulls (("pos",mod_rec_position_to_json x.mod_f_Move_pos) :: [])
;;

let mod_act_setstate_to_json (x)  : json =
    assoc_filter_nulls (("pos",mod_rec_position_to_json x.mod_f_SetState_pos) :: (("nmap",(match Map.extract x.mod_f_SetState_nmap with
        | (l,d) -> (`Assoc (("mapdefault",bool_to_json d) :: (("mapvalues",`List (List.map (fun (x,y) -> `Assoc (("mapkey",mod_rec_position_to_json x) :: (("mapvalue",bool_to_json y) :: []))
        ) l)) :: [])))
    )
    ) :: (("nfuel",int_to_json x.mod_f_SetState_nfuel) :: [])))
;;

let json_of_fix_action (x)  : json =
    (match x with
        | FIX_Action_Move x -> (`Assoc (("tag",`String "Move") :: (("data",mod_act_move_to_json x) :: [])))
        | FIX_Action_SetState x -> (`Assoc (("tag",`String "SetState") :: (("data",mod_act_setstate_to_json x) :: [])))
    )
;;
